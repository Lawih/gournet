
<meta property="fb:app_id" content="1646406112338578">
<meta property="og:title" content="<%=dish.name%>">
<meta property="og:description" content="<%=dish.description%>">

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/es_LA/sdk.js#xfbml=1&version=v2.8&appId=1646406112338578";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="col-md-12" >
  <div class="col-md-12" >
    <h3><a href= "<%= dish_path(dish) %>" class="link"><%= dish.name %></a> -
    <% if chef != nil%>
      <a href= "<%= chef_path(chef) %>" class="link"><%= chef.username %></a>
    <%end%>
    <% if user_signed_in? %>
      <% if current_user.id != dish.chef.id%>
        <%flag = true
          favorite = nil%>
          <%if dish.favorite_dishes !=nil%>
            <% dish.favorite_dishes.each do |favorite_dishe| %>
              <% if favorite_dishe.user.id == current_user.id
                flag = false
                favorite = favorite_dishe
                break
                end%>
            <%end%>
          <%end%>
          <%if flag%>
            <%= link_to "<button class='btn btn-success btn-sm'>Guardar</button>".html_safe,
              new_favorite_dish_path(:user_id => current_user.id, :dish_id => dish.id),
              method: :get %>
          <%else%>
            <%= link_to "<button class='btn btn-danger btn-sm'>Eliminar de guardados</button>".html_safe,
            favorite_dish_path(favorite, :dish_id => favorite.dish_id), method: :delete %>
          <%end%>
      <%end%>
    <%end%></h3>
  </div>
  </br>
  </br>
  <div class="col-md-12">
    <div class="col-md-3" >
      <div class="imgdish-div">
        <%if @dish_images != nil%>
          <% @dish_images.each do |p| %>
            <%= image_tag p.picture_url%>
          <% end %>
        <% end %>
      </div>
    </div>
    <div class=col-md-9>
    <div class="col-md-4" ><b><%= t("activerecord.attributes.dish.score") %>: </b><%= dish.score %></div>
    <div class="col-md-4" ><b><%= t("activerecord.attributes.dish.price") %>:</b> $<%= dish.price %></div>
    <div class="col-md-4" ><b><%= t("activerecord.attributes.dish.calories") %>: </b><%= dish.calories %></div>
    <div class="col-md-12"><b><%= t("activerecord.attributes.dish.description") %>: </b><%= dish.description %></div>

        <div class="col-md-12">
          <% if user_signed_in? %>
            <% if Identity.find_by_user_id(current_user.id) != nil%>
              <% if Identity.find_by_user_id(current_user.id).provider == "facebook"%>
                  <%= link_to "<button class='btn' >Compartir en facebook</button>".html_safe,
                  shareDish_path(:name => dish.name,:description => dish.description,:id => dish.id), data: { confirm: 'Â¿Estas seguro que deseas compartir el plato?' } %>
              <%end%>
            <%end%>
          <%end%>
          <button class="btn btn-primary" id="sharebtn" type="button" onclick="shareURL();" value ="">Compartir link</button>
        </div>
        <div class="col-md-12">
          <br>
          <div id="share" style="display:none;">
            <div class="col-md-8"><%= text_field :shareurl, nil, value: request.original_url, class: "js-copyurl form-control" %></div>
            <div class="col-md-4"><button class="btn btn-primary js-copybutton" id="copyurl" type="button" value ="">Copiar</button></div>
          </div>
        </div>

    <div class="col-md-12" >
        <% if viewmore == true%><%= link_to "<button class='btn btn-embossed btn-primary' >Ver mas</button>".html_safe, dish %><%end%>
        <%= link_to "<button class='btn btn-embossed btn-primary' >Editar</button>".html_safe, edit_dish_path(dish) if policy(dish).edit? %>
        <%= link_to 'Eliminar', dish, :class => "btn btn-embossed btn-primary ", method: :delete, data: { confirm: 'Are you sure?' } if policy(dish).destroy? %>
    </div>
  </div>

  <% if dish.offer.active.count > 0 %>
        <table>
          <tr>
            <th> <%= t("activerecord.attributes.offer.amount") %> </th>
            <th> <%= t("activerecord.attributes.offer.delivery_date") %> </th>
            <th> <%= t("activerecord.attributes.offer.max_date") %> </th>
          </tr>
          <h4> Oferta actual: </h4>
          <% dish.offer.active.each do |offer| %>
              <tr>
                <div class=col-md-3 >
                  <td> <%= offer.amount %> </td>
                </div>
                <div class=col-md-3 >
                  <td>
                    <%= l(offer.delivery_date, format: :day)%>
                    <br>
                    <%= l(offer.delivery_date, format: :hour) %>
                  </td>
                </div>
                <div class=col-md-3 >
                  <td>
                    <%= l(offer.max_date, format: :day)%>
                    <br>
                    <%= l(offer.max_date, format: :hour)%>
                  </td>
                </div>
                <div class=col-md-3 >
                  <td>
                    <% if policy(offer).edit? %>
                      <a href= "<%= edit_offer_url(:id => offer.id) %>" class="btn btn-embossed btn-primary"> <%= t("offers.edit.edit_offer") %> </a>
                    <% else %>
                      <a href= "<%= new_order_url(:offer_id => offer.dish.id) %>" class="btn btn-embossed btn-primary"> <%= t("orders.new.new_order") %> </a>
                    <% end %>
                  </td>
                </div>
              </tr>
          <% end %>
        </table>
    <% end %>
    <% if policy(dish).edit? %>
        <div class=col-md-12 >
          <a href= "<%= new_offer_url(:dish_id => dish.id ) %>" class="btn btn-embossed btn-primary"> <%= t("offers.new.new_offer") %> </a>
        </div>
    <% end %>
  </div>
</div>
